# 2023년 제3회 금융 데이터 활용 아이디어 경진대회
## 팀 프로젝트
제가 맡은 부분은 전처리부터 모델링까지입니다.

여러 개의 데이터를 결합하여 사용할 때 발생하는 결측치를 단순 평균값이나 중앙값 등 하나의 값으로 결측치를 채우는 단순 대치법(Single Imputation)이 아닌, 다중 대치법(Multiple Imputation)을 이용해 채우고, 과적합이 발생하는 base model에 과적합 억제 기법을 적용하여 다중 분류 모델(Multiclass Classification Model)을 구현했습니다.

예측에 사용한 데이터는 '롯데 카드'에서 제공한 '전라북도 행정동 업종별 상권 평가' 데이터와 '소상공인 마당'에서 제공하는 읍면동별 3km를 기준 '직장인구의 상반기 평균 소득, 평균 소비 금액과 하반기 평균 소득, 평균 소비 금액'등을 크롤링한 데이터를 전라북도 지역의 읍면동을 나타내는 컬럼을 기준으로 결합한 데이터입니다.

전라북도 행정동 업종별 상권 평가 데이터에는 범주형 변수로 창업 성공 듭급을 'A'부터 'E'까지 나태난 변수입니다.
<img src="./img/target.png" width="50%" height="50%">

이 종속 변수를 이용하여 두 가지 모델을 만들었습니다. 하나는 창업 성공 등급이 가장 높은 'A'와 'A'가 아닌 등급들을 가지는 업종이 무엇인지 예측하는 이진 분류 모델과 'A'부터 'E'까지 등급을 예측하는 다중 분류 모델입니다. 

이렇게 이진 분류와 다중 분류 모델을 각각 만든 이유는 다음과 같습니다. 
- 이진 분류 모델은 어떤 업종을 전라북도 지역('읍면동')에 창업하면 완전한 성공('A')을 할 수 있는지
- 다중 분류 모델은 어떤 업종을 전라북도 지역에 창업하면 어떤 성공 등급(A~E)을 받을 수 있을지
두 모델을 통해 전라북도 지역 예비 창업자의 의사결정을 돕고자 합니다.

## Stack
```
Python
R
Keras
TensorFlow
```

# 코드 실행
## 1. Data preprocessing
### 1.1 Handling missing values with MICE(Multivariate Imputation by Chained Equations)
아래 .R로 기술되어 있음 https://github.com/HyunJae0/multiclass-classification/blob/main/%EA%B8%88%EC%9C%B5%EB%8D%B0%EC%9D%B4%ED%84%B0%20%EA%B3%B5%EB%AA%A8%EC%A0%84%20%EB%8D%B0%EC%9D%B4%ED%84%B0%20%EA%B2%B0%EC%B8%A1%EA%B0%92%20%EC%B2%98%EB%A6%AC.R

데이터를 결합했을 때 발생하는 결측치 컬럼들은 모두 크롤링 데이터의 컬럼들입니다. 다음과 같이  'a'컬럼부터 'aa'컬럼까지 결측치가 존재하며, 'aaa'라는 컬럼은 결측치가 99%입니다. 
(컬럼명을 영여로 변경한 이유는 결측치를 채우고자 하는 컬럼명이 한글일 경우 오류가 발생하여, 알파벳으로 처리하였습니다. 'a'부터 'aaa'는 10대부터 60대까지의 2022년 상반기, 하반기 평균 소득, 소비 금액이며, 마지막 컬럼은 전북지역 직장인구 수입니다. 'aaa'컬럼은 60대 이상 직장인구의 2022년 하반기 소비 금액입니다.)
<img src="./img/na.png" width="50%" height="50%">

결측치(missing value)는 변수에서 관측치가 없어 발생하는 NA(not available) 값을 의미합니다. 결측치를 제거하고 예측을 수행하면 대부분의 경우에 통계적 추론의 타당성 문제(정보 손실, 표본 편향, 결과 왜곡 등)가 생깁니다. 

결측치를 채우는 일반적인 방법은  특정 통계량(평균, 중앙값, 최빈값) 혹은 그 위에 있는 값이나 아래에 있는 값으로 대체하는 단순 대치법입니다. 하지만 단순 대치법으로 데이터의 결측치를 채우고, 해당 데이터를 사용해 예측을 수행할 경우 특정 대체 값으로 인해 어떤 패턴이 발생한다면, 모델이 이 패턴에 과도하게 의존하게 만들어 새로운 데이터에 대한 일반화 성능을 저하시킬 수 있습니다. 이러한 단순 대치법의 한계를 보완하기 위한 방법이 다중 대치법입니다.

프로젝트에서 사용한 결측치 핸들러는 R에서 제공하는 Multivariate Imputation by Chained Equations(MICE) 패키지입니다. (R에서 제공하는) MICE는 다변량 결측 데이터를 채우기 위해 여러 개의 multiple imputation(대체 값)을 생성합니다. 동작 방법은 다음 예시와 같습니다.
![image](https://github.com/user-attachments/assets/8848db60-42dc-49d9-ac0a-3bc61db0469b)
(출처: https://www.scirp.org/journal/paperinformation?paperid=112455)
Age, Income, Gender라는 세 개의 컬럼에 각각 결측치가 존재합니다.  먼저 각 컬럼별 평균값으로 결측치를 채웁니다. Age의 결측치는 Age 컬럼의 평균값을 이용해 채운 값입니다. Income과 Gender 컬럼에도 동일한 방법으로 결측치를 채웁니다.

그다음, Age의 결측치 부분을 다시 결측치(N.A)로 처리합니다. 이 결측치를 타깃으로 두고 결측치가 없는 데이터(1행, 2행)를 사용해서 타깃을 선형 회귀 모델로 예측합니다. 이 그림에서는 예측 결과로 Age의 N.A 값이 35.3이 나왔습니다. 동일한 방법으로 나머지 컬럼의 결측치를 예측합니다. 이 과정이 하나의 루프입니다. 실제는 여러 번의 루프로 반복해서 진행됩니다.

이 방법을 R의 MICE 패키지를 이용해 사용했으며, 루프 횟수(다중 대치법 횟수)는 default 값 m =5를 사용했습니다. 

다중 대치법은 간단히 말하면 결측치가 있는 데이터 셋에서 m 번의 대치를 통해 결측치를 채우는 방법입니다.
예를 들어 데이터가 100개이고 그중 결측치가 2인 경우, 결측치가 없는 98개의 데이터 중 샘플링을 통해 50개의 데이터를 추출해서 완전한 데이터 셋을 만든다고 가정하겠습니다. 만약 m = 5라면, 각각 샘플링된 50개로 구성된 데이터 셋이 5개가 됩니다.
이 5개의 데이터 셋에 대해 각각 선형 회귀 모델로 학습하여 결측치 값을 예측합니다. 그러면 5개의 데이터 셋 각각에서 서로 다른 예측값을 산출하게 될 것입니다. 최종적으로, 이렇게 얻은 예측값들을 결합(평균이나 다른 방법)하여 대체할 결측치의 최종 값을 도출합니다.

물론 MICE로 채워진 값이 원본 데이터와 정확하게 일치한다는 보장이 없으나 편향이 감소하므로 모델이 특정 패턴에 치우쳐 학습하는 것을 방지할 수 있습니다. 즉, 단순 대치법을 적용하는 것보다 더 실제 데이터처럼 결측치를 채울 수 있습니다.

다음 그림은 R 환경에서 결측치를 MICE 패키지를 사용해 채운 결과입니다.
<img src="./img/fill_na.png" width="50%" height="50%">

